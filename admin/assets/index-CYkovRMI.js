import{p as P}from"./index-Dy79iS0B.js";/* empty css                   *//* empty css                 *//* empty css                     *//* empty css                  *//* empty css               *//* empty css                  */import{u as ne}from"./usePagination-NdQ2qoRW.js";/* empty css                   */import"./el-tooltip-l0sNRNKZ.js";/* empty css                */import{H as re,I as ie,J as ue,z as se,M as de,y as pe,N as me,O as fe,n as _e,W as ge,Q as ve,R as ce,S as xe,T as be,X as ye,Y as L,U as Ve,V as Ce,K as ke,L as Ee,Z as De,E as v}from"./element-B-FiLDCl.js";import{a as B}from"./index-2rTwS3Je.js";import{v as Fe,aE as R,r as m,j as he,x as z,y as x,O as a,G as ze,F as t,u,K as _,E as N,B as C,L as $,M as Pe,ab as Se}from"./vue-Cwi6Gi-M.js";import{_ as Re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vxe-5K_zVHhu.js";function Oe(f){return P({url:"/admin/org/list",method:"post",data:f})}function Te(f){return P({url:"/admin/org/add",method:"post",data:f})}function Ue(f){return P({url:"/admin/org/update",method:"post",data:f})}function Ye(f){return P({url:"/admin/org/update_plan",method:"post",data:f})}const we={class:"app-container"},Me={class:"toolbar-wrapper"},qe={class:"table-wrapper"},Le={key:0},Be={key:1},Ne={class:"pager-wrapper"},$e=Fe({__name:"index",setup(f){const O=R("orgFormRef"),T=R("planFormRef"),U=R("searchFormRef"),k=m(!1),b=m(!1),E=m(!1),D=m({domain:""}),F=m([]),{paginationData:d,handleCurrentChange:I,handleSizeChange:A}=ne(),c=m(!1),s=m({domain:"",name:""}),j={domain:[{required:!0,trigger:"blur",message:"The domain is required."}],name:[{required:!0,trigger:"blur",message:"The name is required."}]},y=m(!1),r=m({domain:"",plan:0,expire_at:"",extra:""}),K={plan:[{required:!0,trigger:"blur",message:"The plan is required."}],expire_at:[{required:!0,trigger:"blur",message:"The expiration date is required."}]};function g(){if(k.value)return;k.value=!0;const o={domain:D.value.domain,curPage:d.currentPage,pageSize:d.pageSize};Oe(o).then(e=>{e.success&&e.data&&e.pagination?(F.value=e.data.org_list,d.total=e.pagination.total):(F.value=[],d.total=0)}).finally(()=>{k.value=!1})}function Y(o){o?s.value={domain:o.domain,name:o.name}:s.value={domain:"",name:""},c.value=!0}function G(o){r.value={domain:o.domain,plan:o.plan??0,expire_at:L(o.expire_at).format("YYYY-MM-DD")??"",extra:o.extra??""},y.value=!0}function H(){var o;(o=U.value)==null||o.resetFields(),g()}function J(){var o;s.value.domain&&(b.value||(o=O.value)==null||o.validate(e=>{if(!e){v.error("The form validation failed.");return}b.value=!0;const p=F.value.some(n=>n.domain===s.value.domain),i={domain:s.value.domain,name:s.value.name};p?Ue(i).then(n=>{n.success?(v.success("Succeed to update."),c.value=!1,g()):v.error(n.message||"Failed to update.")}).finally(()=>{b.value=!1}):Te(i).then(n=>{n.success?(v.success("Succeed to add."),c.value=!1,g()):v.error(n.message||"Failed to add.")}).finally(()=>{b.value=!1})}))}function Q(){var o;r.value.domain&&(E.value||(o=T.value)==null||o.validate(e=>{if(!e){v.error("The form validation failed.");return}E.value=!0;const p={domain:r.value.domain,plan:r.value.plan,expire_at:`${r.value.expire_at} 00:00:00`,extra:r.value.extra};Ye(p).then(i=>{i.success?(y.value=!1,g()):v.error(i.message||"Failed to update.")}).finally(()=>{E.value=!1})}))}return he([()=>d.currentPage,()=>d.pageSize],g,{immediate:!0}),(o,e)=>{const p=ue,i=ie,n=se,S=re,w=me,M=_e,V=xe,W=be,X=ce,Z=Ve,q=Ce,ee=Ee,ae=ke,le=De,te=fe;return x(),z("div",we,[a(w,{shadow:"never",class:"search-wrapper"},{default:t(()=>[a(S,{inline:!0,ref_key:"searchFormRef",ref:U,model:D.value},{default:t(()=>[a(i,{label:"Domain",prop:"domain"},{default:t(()=>[a(p,{modelValue:D.value.domain,"onUpdate:modelValue":e[0]||(e[0]=l=>D.value.domain=l),placeholder:"Search domain",clearable:""},null,8,["modelValue"])]),_:1}),a(i,null,{default:t(()=>[a(n,{type:"primary",icon:u(de),onClick:g},{default:t(()=>e[12]||(e[12]=[_(" Search ")])),_:1,__:[12]},8,["icon"]),a(n,{icon:u(pe),onClick:H},{default:t(()=>e[13]||(e[13]=[_(" Reset ")])),_:1,__:[13]},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),ze((x(),N(w,{shadow:"never"},{default:t(()=>[C("div",Me,[e[14]||(e[14]=C("div",null,null,-1)),C("div",null,[a(M,{content:"Add new"},{default:t(()=>[a(n,{type:"primary",icon:u(ge),circle:"",onClick:e[1]||(e[1]=l=>Y())},null,8,["icon"])]),_:1}),a(M,{content:"Refresh current page"},{default:t(()=>[a(n,{type:"primary",icon:u(ve),circle:"",onClick:g},null,8,["icon"])]),_:1})])]),C("div",qe,[a(X,{data:F.value,stripe:""},{default:t(()=>[a(V,{prop:"domain",label:"Domain"}),a(V,{prop:"name",label:"Name"}),a(V,{prop:"plan",label:"Plan"},{default:t(({row:l})=>[a(W,{type:"primary"},{default:t(()=>{var h;return[_($((h=u(B).find(oe=>oe.id===l.plan))==null?void 0:h.text),1)]}),_:2},1024),a(n,{type:"primary",text:"",size:"small",icon:u(ye),onClick:h=>G(l)},null,8,["icon","onClick"])]),_:1}),a(V,{prop:"expire_at",label:"Expire"},{default:t(({row:l})=>[l.expire_at?(x(),z("span",Le,$(u(L)(l.expire_at).format("YYYY-MM-DD")),1)):(x(),z("span",Be,"-"))]),_:1}),a(V,{label:"Action",width:"100"},{default:t(({row:l})=>[a(n,{type:"primary",plain:"",size:"small",onClick:h=>Y(l)},{default:t(()=>e[15]||(e[15]=[_(" Edit ")])),_:2,__:[15]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),C("div",Ne,[a(Z,{background:"",layout:u(d).layout,total:u(d).total,"page-size":u(d).pageSize,"current-page":u(d).currentPage,onSizeChange:u(A),onCurrentChange:u(I)},null,8,["layout","total","page-size","current-page","onSizeChange","onCurrentChange"])])]),_:1})),[[te,k.value]]),a(q,{title:"Organization",modelValue:c.value,"onUpdate:modelValue":e[5]||(e[5]=l=>c.value=l),width:"500px"},{footer:t(()=>[a(n,{onClick:e[4]||(e[4]=l=>c.value=!1)},{default:t(()=>e[16]||(e[16]=[_(" Cancel ")])),_:1,__:[16]}),a(n,{type:"primary",onClick:J,loading:b.value},{default:t(()=>e[17]||(e[17]=[_(" Save ")])),_:1,__:[17]},8,["loading"])]),default:t(()=>[a(S,{ref_key:"orgFormRef",ref:O,model:s.value,rules:j,"label-width":"120px","label-position":"left"},{default:t(()=>[a(i,{prop:"domain",label:"Domain"},{default:t(()=>[a(p,{modelValue:s.value.domain,"onUpdate:modelValue":e[2]||(e[2]=l=>s.value.domain=l)},null,8,["modelValue"])]),_:1}),a(i,{prop:"name",label:"Name"},{default:t(()=>[a(p,{modelValue:s.value.name,"onUpdate:modelValue":e[3]||(e[3]=l=>s.value.name=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(q,{title:"Update Plan",modelValue:y.value,"onUpdate:modelValue":e[11]||(e[11]=l=>y.value=l),width:"500px"},{footer:t(()=>[a(n,{bg:"",onClick:e[10]||(e[10]=l=>y.value=!1)},{default:t(()=>e[18]||(e[18]=[_(" Cancel ")])),_:1,__:[18]}),a(n,{bg:"",type:"primary",onClick:Q,loading:E.value},{default:t(()=>e[19]||(e[19]=[_(" Update ")])),_:1,__:[19]},8,["loading"])]),default:t(()=>[a(S,{ref_key:"planFormRef",ref:T,model:r.value,rules:K,"label-width":"120px","label-position":"left"},{default:t(()=>[a(i,{label:"Domain"},{default:t(()=>[a(p,{modelValue:r.value.domain,"onUpdate:modelValue":e[6]||(e[6]=l=>r.value.domain=l),disabled:""},null,8,["modelValue"])]),_:1}),a(i,{label:"Plan",prop:"plan"},{default:t(()=>[a(ae,{modelValue:r.value.plan,"onUpdate:modelValue":e[7]||(e[7]=l=>r.value.plan=l),placeholder:"Select Plan",class:"w-full"},{default:t(()=>[(x(!0),z(Pe,null,Se(u(B),l=>(x(),N(ee,{key:l.id,label:l.text,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"Expire At",prop:"expire_at"},{default:t(()=>[a(le,{modelValue:r.value.expire_at,"onUpdate:modelValue":e[8]||(e[8]=l=>r.value.expire_at=l),"value-format":"YYYY-MM-DD",class:"w-full"},null,8,["modelValue"])]),_:1}),a(i,{label:"Extra",prop:"extra"},{default:t(()=>[a(p,{modelValue:r.value.extra,"onUpdate:modelValue":e[9]||(e[9]=l=>r.value.extra=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),na=Re($e,[["__scopeId","data-v-b334ae55"]]);export{na as default};
