import{n as ae,o as T}from"./index-BYdHSxkt.js";/* empty css                   */import{u as le}from"./usePagination-NdQ2qoRW.js";/* empty css                   *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 */import"./el-tooltip-l0sNRNKZ.js";/* empty css                *//* empty css                  */import{G as te,H as ne,I as oe,J as se,K as re,L as ie,z as ue,M as de,y as me,N as pe,O as ce,n as fe,P as _e,Q as ge,R as ve,S as be,T as ye,U as he,V as Ce,E as p}from"./element-B-FiLDCl.js";import{M as N,a as Ee}from"./index-2rTwS3Je.js";import{v as Ve,r as b,aE as B,W as ke,j as Se,x as z,y as g,O as a,G as Fe,F as n,u as t,M as I,ab as O,E as x,K as c,B as y,U as we,L as j,I as M,k as xe}from"./vue-Cwi6Gi-M.js";import{_ as Re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vxe-5K_zVHhu.js";const Ue={class:"app-container"},Pe={class:"toolbar-wrapper"},ze={class:"table-wrapper"},De={class:"pager-wrapper"},Le=Ve({name:"ElementPlus",__name:"index",setup(Te){const{paginationData:s,handleCurrentChange:q,handleSizeChange:A}=le(),C=b(!1),E=b(!1),V=b(!1),v=b(!1),R=B("userFormRef"),u=b(te({email:"",status:"0"})),$={email:[{required:!0,trigger:"blur",message:"The email is required."}],status:[{required:!0,trigger:"blur",message:"The status is required."}]},G=[{label:"Active",value:"0"},{label:"Suspend",value:"1"},{label:"Inacitve",value:"2"}];function J(){var o;u.value.ms_id&&(E.value||(o=R.value)==null||o.validate(e=>{if(!e){p.error("Form validation failed.");return}E.value=!0;const f={ms_id:u.value.ms_id,status:Number.parseInt(u.value.status,10)};ae(f).then(i=>{i.success?(p.success("Succeed to update."),v.value=!1,k()):p.error(i.message||"Failed to update.")}).catch(()=>{p.error("Failed to update.")}).finally(()=>{E.value=!1})}))}function K(){var o;(o=R.value)==null||o.clearValidate(),u.value={email:"",status:"0"}}function H(o){v.value=!0,u.value={ms_id:o.ms_id,email:o.email,status:`${o.status}`}}const U=b([]),D=B("searchFormRef"),r=ke({email:"",name:"",plan:N.FREE});function k(){if(C.value)return;C.value=!0;const o={name:r.name||"",email:r.email||"",plan:r.plan>=N.FREE?r.plan:void 0,page:s.currentPage-1,page_size:s.pageSize};r.plan===-1&&(o.plan=3),T(o).then(e=>{if(!e.success){p.error(e.message||"Error");return}e.data&&e.pagination&&(s.total=e.pagination.total,U.value=e.data.user_list)}).catch(()=>{U.value=[],s.total=0}).finally(()=>{C.value=!1})}function L(){s.currentPage===1?k():s.currentPage=1}function Q(){var o;(o=D.value)==null||o.resetFields(),L()}Se([()=>s.currentPage,()=>s.pageSize],k,{immediate:!0});async function W(){if(!V.value){V.value=!0;try{const e=await T({name:"",email:"",plan:3,page:0,page_size:0});if(!e.success){p.error(e.message||"Failed to fetch user data");return}const f=e.data&&(e.data.user_list||e.data)||[],i=["ms_id","name","email","plan","is_admin","is_tester","status","verified"],S=f.map(w=>i.map(_=>JSON.stringify(w[_]??"")).join(",")),F=[i.join(","),...S].join(`
`),d=new Blob([F],{type:"text/csv;charset=utf-8;"}),h=URL.createObjectURL(d),m=document.createElement("a");m.href=h,m.download=`users_${Date.now()}.csv`,document.body.appendChild(m),m.click(),m.remove(),URL.revokeObjectURL(h),p.success("CSV download started")}catch{p.error("Failed to download CSV")}finally{V.value=!1}}}return(o,e)=>{const f=se,i=oe,S=ie,F=re,d=ue,h=ne,m=pe,w=fe,_=be,P=ye,X=ve,Y=he,Z=Ce,ee=ce;return g(),z("div",Ue,[a(m,{shadow:"never",class:"search-wrapper"},{default:n(()=>[a(h,{ref_key:"searchFormRef",ref:D,inline:!0,model:t(r)},{default:n(()=>[a(i,{prop:"email",label:"Email"},{default:n(()=>[a(f,{modelValue:t(r).email,"onUpdate:modelValue":e[0]||(e[0]=l=>t(r).email=l),placeholder:"Search email"},null,8,["modelValue"])]),_:1}),a(i,{prop:"name",label:"Name"},{default:n(()=>[a(f,{modelValue:t(r).name,"onUpdate:modelValue":e[1]||(e[1]=l=>t(r).name=l),placeholder:"Search name"},null,8,["modelValue"])]),_:1}),a(i,{prop:"plan",label:"Plan"},{default:n(()=>[a(F,{modelValue:t(r).plan,"onUpdate:modelValue":e[2]||(e[2]=l=>t(r).plan=l),placeholder:"Select Plan",style:{width:"160px"}},{default:n(()=>[(g(!0),z(I,null,O(t(Ee),l=>(g(),x(S,{key:l.id,label:l.text,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(i,null,{default:n(()=>[a(d,{type:"primary",icon:t(de),onClick:L},{default:n(()=>e[7]||(e[7]=[c(" Search ")])),_:1,__:[7]},8,["icon"]),a(d,{icon:t(me),onClick:Q},{default:n(()=>e[8]||(e[8]=[c(" Reset ")])),_:1,__:[8]},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),Fe((g(),x(m,{shadow:"never"},{default:n(()=>[y("div",Pe,[e[9]||(e[9]=y("div",null,null,-1)),y("div",null,[a(w,{content:"Download CSV"},{default:n(()=>[a(d,{loading:t(V),type:"primary",icon:t(_e),circle:"",onClick:W},null,8,["loading","icon"])]),_:1}),a(w,{content:"Refresh current page"},{default:n(()=>[a(d,{type:"primary",icon:t(ge),circle:"",onClick:k},null,8,["icon"])]),_:1})])]),y("div",ze,[a(X,{data:t(U),style:{width:"100%"}},{default:n(()=>[a(_,{type:"selection",width:"50",align:"center"}),a(_,{prop:"name",label:"Name",align:"left"},{default:n(({row:l})=>[y("span",{style:we({color:l.status===1?"red":l.status===2?"gray":"inherit"})},j(l.name),5)]),_:1}),a(_,{prop:"email",label:"Email",align:"left"}),a(_,{label:"Plan",align:"left"},{default:n(({row:l})=>[a(P,{effect:"dark",type:"info",style:{background:"#2d8cf0",color:"#fff","border-radius":"8px","margin-right":"6px"},"disable-transitions":""},{default:n(()=>[c(j(l.plan),1)]),_:2},1024),l.is_admin?(g(),x(P,{key:0,effect:"dark",type:"warning",style:{background:"#f90",color:"#fff","border-radius":"8px","margin-right":"6px"},"disable-transitions":""},{default:n(()=>e[10]||(e[10]=[c(" Admin ")])),_:1,__:[10]})):M("",!0),l.is_tester?(g(),x(P,{key:1,effect:"dark",type:"success",style:{background:"#19be6b",color:"#fff","border-radius":"8px","margin-right":"6px"},"disable-transitions":""},{default:n(()=>e[11]||(e[11]=[c(" Tester ")])),_:1,__:[11]})):M("",!0)]),_:1}),a(_,{fixed:"right",label:"Action",width:"150",align:"center"},{default:n(({row:l})=>[a(d,{type:"primary",plain:"",size:"small",onClick:Ne=>H(l)},{default:n(()=>e[12]||(e[12]=[c(" Edit ")])),_:2,__:[12]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),y("div",De,[a(Y,{background:"",layout:t(s).layout,"page-sizes":t(s).pageSizes,total:t(s).total,"page-size":t(s).pageSize,"current-page":t(s).currentPage,onSizeChange:t(A),onCurrentChange:t(q)},null,8,["layout","page-sizes","total","page-size","current-page","onSizeChange","onCurrentChange"])])]),_:1})),[[ee,t(C)]]),a(Z,{modelValue:t(v),"onUpdate:modelValue":e[6]||(e[6]=l=>xe(v)?v.value=l:null),title:t(u).ms_id?"Edit User":"Add User",width:"30%",onClosed:K},{footer:n(()=>[a(d,{onClick:e[5]||(e[5]=l=>v.value=!1)},{default:n(()=>e[13]||(e[13]=[c(" Cancel ")])),_:1,__:[13]}),a(d,{type:"primary",loading:t(E),onClick:J},{default:n(()=>e[14]||(e[14]=[c(" Confirm ")])),_:1,__:[14]},8,["loading"])]),default:n(()=>[a(h,{ref_key:"userFormRef",ref:R,model:t(u),rules:$,"label-width":"100px","label-position":"left"},{default:n(()=>[a(i,{prop:"email",label:"Email"},{default:n(()=>[a(f,{modelValue:t(u).email,"onUpdate:modelValue":e[3]||(e[3]=l=>t(u).email=l),disabled:"",placeholder:"Please enter"},null,8,["modelValue"])]),_:1}),a(i,{prop:"status",label:"Status"},{default:n(()=>[a(F,{modelValue:t(u).status,"onUpdate:modelValue":e[4]||(e[4]=l=>t(u).status=l),placeholder:"Please select"},{default:n(()=>[(g(),z(I,null,O(G,l=>a(S,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Ze=Re(Le,[["__scopeId","data-v-a6071465"]]);export{Ze as default};
